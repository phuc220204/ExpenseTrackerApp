# Project Blueprint: Smart Expense Tracker

Đây là tài liệu quy chuẩn (Blueprint) cho dự án Expense Tracker tích hợp AI. Tài liệu này được thiết kế để định hướng phát triển, bảo trì và tái sử dụng cho các dự án tương tự.

## 1. Tổng Quan Dự Án (Project Overview)

- **Tên dự án:** Personal Expense Tracker
- **Mục tiêu:** Quản lý dòng tiền cá nhân (Thu/Chi), phân tích thói quen tiêu dùng thông qua biểu đồ và trợ lý ảo AI.
- **Nền tảng:** Web Application (PWA Ready).
- **Thiết kế:** Mobile-First (ưu tiên giao diện điện thoại), Responsive.
- **Ngôn ngữ chính:** Tiếng Việt (UI & Comments).

## 2. Công Nghệ & Thư Viện (Tech Stack)

Tuân thủ nghiêm ngặt các công nghệ sau:

### Core

- **Runtime:** Node.js (Latest LTS)
- **Framework:** React 19+ (Vite Build Tool)
- **Language:** JavaScript (ES6+) hoặc TypeScript (Khuyến khích)
- **Styling:** Tailwind CSS (v4 hoặc v3.4+)
- **Icons:** lucide-react

### UI Library & Components

- **Primary Library:** Hero UI (formerly NextUI) - Sử dụng cho Layout, Card, Modal, Input, Button.
- **Charts:** Recharts (Customized để giống Shadcn Charts - tối giản, clean).
- **Animations:** Framer Motion (cho transitions và micro-interactions).

### Backend & Services (Serverless)

- **Platform:** Firebase
- **Auth:** Firebase Authentication (Google Sign-In).
- **Database:** Cloud Firestore (NoSQL).
- **Storage:** Firebase Storage (nếu cần lưu ảnh hóa đơn).
- **Deployment:** Firebase Hosting.

### AI Engine

- **Provider:** Google Gemini (Generative AI).
- **SDK:** `@google/generative-ai`.
- **Strategy:** BYOK (Bring Your Own Key) - User tự nhập API Key, lưu tại LocalStorage.

## 3. Kiến Trúc Hệ Thống (Architecture)

### Cấu Trúc Thư Mục (Folder Structure)

Áp dụng **Colocation Pattern**: Code liên quan đi cùng nhau.

```
src/
├── components/           # UI Components
│   ├── ComponentName/    # Complex Component (>100 lines or has logic)
│   │   ├── ComponentName.jsx  # View (JSX only)
│   │   ├── useComponentName.js # Logic (Custom Hook)
│   │   └── constants.js        # Static Data/Config
│   └── SimpleComponent.jsx    # Simple stateless component
├── contexts/            # Global State (Auth, Theme, Data)
├── hooks/               # Shared Custom Hooks
├── pages/               # Route Components
├── services/            # API Services (Firebase, Gemini)
└── utils/               # Helper Functions
```

### Quy Tắc Phân Tách (Separation of Concerns)

1.  **View (.jsx):** Chỉ chứa JSX và gọi hook. Không chứa logic tính toán phức tạp.
2.  **Logic (Custom Hooks):** Chứa state, useEffect, xử lý sự kiện.
3.  **Service Layers:** Tách biệt code gọi API (Firestore, Gemini) ra khỏi UI.

## 4. Mô Hình Dữ Liệu (Data Schema)

### Firestore Collections

#### `users/{userId}/transactions/{transactionId}`

Lưu trữ giao dịch thu chi.

```json
{
  "id": "string (uuid)",
  "userId": "string (auth.uid)",
  "type": "expense" | "income",
  "amount": number,
  "category": "string (Format: 'Category > Subcategory')",
  "date": "string (YYYY-MM-DD)",
  "note": "string",
  "paymentMethod": "cash" | "transfer",
  "bankName": "string (optional)",
  "createdAt": "Timestamp"
}
```

### Bảo Mật (Security & Rules)

- **Firestore Rules:** BẮT BUỘC có rule kiểm tra `request.auth.uid == userId`.
- **API Keys:** Key Gemini lưu ở client (LocalStorage), KHÔNG lưu server/database.

## 5. Tiêu Chuẩn Coding (Coding Standards)

### Naming Conventions

- **Components:** PascalCase (e.g., `TransactionList.jsx`)
- **Functions/Hooks:** camelCase (e.g., `useTransactions`, `formatCurrency`)
- **Constants:** UPPER_CASE (e.g., `MAX_RETRY_COUNT`)

### Comments & Documentation

- **Ngôn ngữ:** Tiếng Việt.
- **JSDoc:** Bắt buộc cho tất cả custom hooks, service functions và utility functions.
- **Explain WHY:** Comment giải thích TẠI SAO làm vậy, không chỉ là làm CÁI GÌ.

```javascript
/**
 * Hook xử lý logic thêm giao dịch
 * Sử dụng Optimistic UI để phản hồi ngay lập tức cho user
 * @param {string} userId
 */
```

### AI Integration Guidelines

Hệ thống AI đóng vai trò là "Trợ lý tài chính".

1.  **Input:** Ngôn ngữ tự nhiên (Tiếng Việt).
2.  **Process:** Convert sang structured commands (JSON).
3.  **Output:** Thực thi lệnh (Add/Query) + Trả lời user.
4.  **Prompt Engineering:** Luôn inject thời gian hiện tại vào System Prompt để xử lý các từ chỉ thời gian tương đối ("hôm qua", "tuần trước").

## 6. Quy Trình Phát Triển (Workflows)

### Thêm Tính Năng Mới

1.  **Design:** Xác định input/output và cập nhật Schema nếu cần.
2.  **Service:** Viết hàm tương tác Firebase/API trong `services/`.
3.  **Hook:** Tạo custom hook để nối Service với State.
4.  **UI:** Xây dựng Component hiển thị.

### Kiểm Thử (Testing) - _Recommended_

- Tối thiểu: Kiểm tra flux luồng đi của dữ liệu (Data Flow).
- Ràng buộc: Kiểm tra validate input số tiền (không âm), ngày tháng hợp lệ.

### Quản lý Dependencies (Library Installation)

- **Quy tắc:** Khi cài đặt thư viện mới, luôn ưu tiên sử dụng cờ `--legacy-peer-deps` để tránh lỗi xung đột phiên bản (ERESOLVE), đặc biệt là với các thư viện UI như HeroUI/NextUI và TailwindCSS.
- **Lệnh chuẩn:** `npm install <package-name> --legacy-peer-deps`

---

_Tài liệu này được tạo tự động bởi AI Assistant và được tối ưu hóa cho việc phát triển các ứng dụng quản lý cá nhân hiện đại._
